# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦
9ç—…é™¢ãƒ»å¤šè·ç¨®å‘ã‘é™¢å†…æ¥­å‹™åŸºç›¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ç›®æ¬¡

### ğŸ“‹ è¦ä»¶ãƒ»è¨­è¨ˆ
- [database-security-requirements.md](../requirements/database-security-requirements.md) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### ğŸ”’ RLSï¼ˆRow Level Securityï¼‰
- [fix-rls-policies.sql](../../fix-rls-policies.sql) - RLSãƒãƒªã‚·ãƒ¼ä¿®æ­£
- [fix-user-permissions.sql](../../fix-user-permissions.sql) - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ä¿®æ­£
- [fix-chat-rls-emergency.sql](../../fix-chat-rls-emergency.sql) - ãƒãƒ£ãƒƒãƒˆRLSç·Šæ€¥ä¿®æ­£
- [fix-chat-rls-new-schema.sql](../../fix-chat-rls-new-schema.sql) - ãƒãƒ£ãƒƒãƒˆRLSæ–°ã‚¹ã‚­ãƒ¼ãƒä¿®æ­£
- [fix-chat-sessions-rls.sql](../../fix-chat-sessions-rls.sql) - ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³RLSä¿®æ­£
- [fix-chat-rls.sql](../../fix-chat-rls.sql) - ãƒãƒ£ãƒƒãƒˆRLSä¿®æ­£
- [disable-rls-analytics.sql](../../disable-rls-analytics.sql) - åˆ†æRLSç„¡åŠ¹åŒ–

### ğŸ›¡ï¸ èªè¨¼ãƒ»èªå¯
- [auth-requirements.md](../requirements/auth-requirements.md) - èªè¨¼è¦ä»¶

### ğŸ” æ¤œè¨¼ãƒ»ç›£æŸ»
- [check-foreign-keys.sql](../../check-foreign-keys.sql) - å¤–éƒ¨ã‚­ãƒ¼ç¢ºèª
- [verify-database.sql](../../verify-database.sql) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œè¨¼

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡

### ç¾åœ¨ã®è¨­å®šæ–¹é‡
- **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: DBã«åˆã‚ã›ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´
- **ç†ç”±**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ç¶­æŒã€æ®µéšçš„æ”¹å–„
- **ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«**: ä½

### å®Ÿè£…æ–¹é‡
1. æ—¢å­˜ã®RLSè¨­å®šï¼ˆauth.uid()ãƒ™ãƒ¼ã‚¹ï¼‰ã‚’ç¶­æŒ
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§è©³ç´°ãªæ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¼·åŒ–

### å°†æ¥çš„ãªæ”¹å–„è¨ˆç”»
- **Phase 1**: ç¾çŠ¶ç¶­æŒ + ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- **Phase 2**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¨©é™ãƒã‚§ãƒƒã‚¯è¿½åŠ 
- **Phase 3**: DBã®RLSè¨­å®šæ®µéšçš„å¼·åŒ–

## ä½¿ç”¨æ–¹æ³•

### RLSãƒãƒªã‚·ãƒ¼ä¿®æ­£
1. è©²å½“ã™ã‚‹ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å®Ÿè¡Œãƒ»æ¤œè¨¼
3. æœ¬ç•ªç’°å¢ƒã§å®Ÿè¡Œ
4. å‹•ä½œç¢ºèª

### æ¨©é™ç¢ºèª
- `check-foreign-keys.sql` ã§æ•´åˆæ€§ç¢ºèª
- `verify-database.sql` ã§å…¨ä½“çš„ãªæ¤œè¨¼

## æ³¨æ„äº‹é …
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå¤‰æ›´å‰ã¯å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ååˆ†ãªæ¤œè¨¼ã‚’å®Ÿæ–½
- æ®µéšçš„ãªå¤‰æ›´ã‚’æ¨å¥¨
- ç›£æŸ»ãƒ­ã‚°ã®ç¢ºèªã‚’å®šæœŸå®Ÿæ–½
