# Selectページ 要件定義書

## 概要

Selectページは、S-BOT医療業務支援システムの機能選択画面です。ユーザーが利用可能な機能を選択し、適切なページにナビゲートするためのハブとして機能します。

## 基本仕様

### ページ構成
- **URL**: `/Select`
- **レイアウト**: 左サイドバー + メインコンテンツ
- **レスポンシブ対応**: デスクトップ、タブレット、モバイル

### 認証要件
- ログイン必須
- ユーザー権限に基づく機能フィルタリング
- セッション管理

## レイアウト構成

### 1. 左サイドバー (Sidebar)

#### 基本仕様
- **デスクトップ**: 常設表示 (幅: 72px)
- **モバイル**: ハンバーガーメニューで開閉
- **背景色**: 白 (`bg-white`)
- **ボーダー**: 右側にグレーボーダー (`border-r border-gray-200`)

#### 構成要素

##### ヘッダー部分
- **S-BOTロゴ**: クローバーアイコン (`/image/clover.svg`)
- **システム名**: "S-BOT"
- **説明**: "医療業務支援システム"

##### ユーザー情報部分
- **アバター**: ユーザー名の頭文字
- **ユーザー名**: プロフィールから取得
- **部署名**: プロフィールから取得

##### メインナビゲーション
- **ホーム**: `/` (メインページ)
- **AIチャット**: `/AIchat`
- **スケジュール**: `/schedule/riha`
- **お知らせ**: `/announcements`
- **管理設定**: `/admin/analytics` (管理者のみ)

##### ヘルプ・サポート
- **S-BOTとは**: `/help/about`
- **できること**: `/help/features`
- **FAQ**: `/help/faq`
- **お問い合わせ**: `/help/contact`

##### フッター
- **ログアウトボタン**: セッション終了

#### スタイリング
- **ホバー効果**: 緑色 (`hover:text-green-700 hover:bg-green-50`)
- **アクティブ状態**: 緑色の背景
- **アイコン**: Lucide React アイコン

### 2. 上部ヘッダー (Header)

#### 基本仕様
- **位置**: メインコンテンツ上部
- **固定表示**: `sticky top-0`
- **背景色**: 白 (`bg-white`)
- **ボーダー**: 下部にグレーボーダー (`border-b border-gray-200`)

#### 構成要素

##### 左側
- **モバイルメニューボタン**: ハンバーガーアイコン (モバイルのみ表示)
- **ロゴ**: クローバーアイコン (`/image/clover.svg`, 32x32px)

##### 右側
- **通知ベル**: 未読通知の赤いドット付き
- **ユーザー情報**: アバター + 名前・部署 (デスクトップのみ表示)

### 3. メインコンテンツ

#### 基本仕様
- **背景色**: グレー (`bg-gray-50`)
- **パディング**: デスクトップ 24px、モバイル 16px
- **最大幅**: 6xl (`max-w-6xl`)

#### 構成要素

##### 検索機能 (SearchPalette)
- **コマンドパレット**: ⌘/Ctrl+K で起動
- **検索対象**: 機能名、部署、タグ
- **キーボードナビゲーション**: 矢印キー + Enter
- **リアルタイム検索**: 入力と同時にフィルタリング
- **KPI目標**: 検索→遷移率 >70%、平均キー入力 ≤3

##### カテゴリフィルター (CategoryFilter)
- **チップ形式**: 部署別フィルタリング
- **カウント表示**: 各カテゴリの件数表示
- **全件表示**: "すべて" オプション
- **動的生成**: 利用可能な部署から自動生成

##### レイアウトスイッチャー (LayoutSwitcher)
- **グリッド表示**: カード形式のレイアウト
- **リスト表示**: シンプルなリスト形式
- **セグメント化**: レイアウトのみを切り替え

##### 機能選択エリア
- **権限フィルタリング**: ユーザー権限に基づく表示制御
- **ナビゲーション**: 選択時のページ遷移
- **ローディング状態**: 遷移中の表示
- **縦スクロール**: カルーセル廃止、全件表示

##### 病院ニュース
- **表示位置**: 機能選択エリアの下部
- **内容**: 病院からのお知らせ

##### フッター
- **著作権表示**: "© 2025 Koreha Maenaka ga tukutta. www."

## 機能仕様

### 1. 検索機能

#### コマンドパレット
```typescript
// キーボードショートカット
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      setSearchPaletteOpen(true);
    }
  };
}, []);
```

#### 検索ロジック
- **機能名検索**: ラベル名での部分一致
- **部署検索**: 部署名での部分一致
- **タグ検索**: 説明文での部分一致
- **大文字小文字**: 区別なし

#### キーボードナビゲーション
- **↑↓**: 検索結果の選択
- **Enter**: 選択した機能を開く
- **Esc**: パレットを閉じる

### 2. カテゴリフィルタリング

#### フィルタリングロジック
```typescript
const categoryFilteredOptions = useMemo(() => {
  if (selectedCategory === 'すべて') {
    return filteredOptions;
  }
  return filteredOptions.filter(option => option.department === selectedCategory);
}, [filteredOptions, selectedCategory]);
```

#### カウント表示
- **動的カウント**: 各カテゴリの利用可能件数
- **リアルタイム更新**: 権限変更時の自動更新

### 3. 権限管理

#### 管理者権限
```typescript
const isAdmin = profile?.role === '管理者' || 
                profile?.role === '研究員' || 
                profile?.position === '管理職';
```

#### フィルタリングロジック
- **管理者**: 全機能表示
- **一般ユーザー**: 管理機能を除外

### 4. ナビゲーション

#### ページ遷移
- **React Router**: `useRouter`を使用
- **トランジション**: `useTransition`でローディング状態管理
- **二重押下防止**: 遷移中の重複クリック防止

### 5. アナウンス機能

#### ポップアップ表示
- **表示条件**: ユーザーログイン後、未読アナウンスあり
- **対象部署**: ユーザーの部署に応じたフィルタリング
- **表示制御**: localStorageで閉じたアナウンスを管理

#### アナウンス管理
- **表示回数カウント**: 個別アナウンスの表示回数追跡
- **閉じたアナウンス**: ユーザーが閉じたアナウンスの記録

### 6. レスポンシブ対応

#### ブレークポイント
- **モバイル**: `< 1024px`
- **デスクトップ**: `>= 1024px`

#### 表示制御
- **サイドバー**: モバイルではオーバーレイ表示
- **ヘッダー**: モバイルではメニューボタン表示
- **ユーザー情報**: モバイルではアバターのみ表示

## データ構造

### 1. オプションデータ (data.ts)

```typescript
interface Option {
  id: string;
  label: string;
  href: string;
  department: string;
  description?: string;
}
```

### 2. レイアウトタイプ

```typescript
type LayoutType = 'grid' | 'list';
```

### 3. アナウンスデータ

```typescript
interface Announcement {
  id: string;
  title: string;
  content: string;
  department: string;
  displayCount: number;
}
```

## スタイリング仕様

### 1. カラーパレット
- **メインカラー**: 緑色 (`#16A34A`)
- **背景色**: グレー (`bg-gray-50`)
- **ボーダー**: グレー (`border-gray-200`)
- **テキスト**: グレー (`text-gray-900`, `text-gray-500`)

### 2. カードデザイン

#### 基本仕様
- **全面クリック**: カード全体がクリック可能
- **ホバー効果**: 影の追加、上方向への移動
- **フォーカスリング**: アクセシビリティ対応
- **最小タップ領域**: 44px以上

#### メニューボタン
- **位置**: 右上
- **表示**: ホバー時のみ表示
- **アイコン**: 三点リーダー (`MoreHorizontal`)

#### CTAアイコン
- **アイコン**: 矢印 (`ArrowRight`)
- **アニメーション**: ホバー時の右方向移動
- **色変更**: ホバー時の緑色化

### 3. アニメーション
- **トランジション**: 0.2秒のイージング
- **ホバー効果**: スケール変更 (`hover:-translate-y-1`)
- **ローディング**: スピナーアニメーション

### 4. タイポグラフィ
- **フォント**: システムフォント
- **サイズ**: レスポンシブ対応
- **ウェイト**: セミボールド、ミディアム

## セキュリティ要件

### 1. 認証
- **必須認証**: 全ページでログイン必須
- **セッション管理**: AuthContextによる状態管理
- **権限チェック**: リアルタイム権限検証

### 2. データ保護
- **入力検証**: クライアントサイドバリデーション
- **XSS対策**: Reactの自動エスケープ
- **CSRF対策**: Supabaseの組み込み保護

## パフォーマンス要件

### 1. 読み込み速度
- **初期表示**: 3秒以内
- **ナビゲーション**: 1秒以内
- **検索応答**: 0.5秒以内
- **画像最適化**: Next.js Image最適化

### 2. KPI目標
- **ファーストクリック到達時間**: P95で2.0s→1.2s
- **検索→遷移率**: >70%
- **検索からの平均キー入力**: ≤3

### 3. メモリ使用量
- **コンポーネント**: 適切なメモ化
- **状態管理**: 必要最小限の状態保持
- **クリーンアップ**: useEffectでの適切なクリーンアップ

## アクセシビリティ要件

### 1. キーボードナビゲーション
- **フォーカス管理**: 適切なフォーカス順序
- **ショートカット**: 標準的なキーボードショートカット対応
- **検索パレット**: 完全なキーボード操作対応

### 2. スクリーンリーダー
- **aria属性**: 適切なaria属性設定
- **セマンティックHTML**: 意味のあるHTML構造
- **alt属性**: 画像の適切なalt属性

### 3. 色覚対応
- **コントラスト**: WCAG AA準拠のコントラスト比
- **色以外の手がかり**: アイコンやテキストによる識別

### 4. タップ領域
- **最小サイズ**: 44px以上
- **間隔**: 適切なタップ間隔
- **フィードバック**: 視覚的・触覚的フィードバック

## テスト要件

### 1. 単体テスト
- **コンポーネント**: 各コンポーネントの動作確認
- **フック**: カスタムフックの動作確認
- **ユーティリティ**: ヘルパー関数の動作確認

### 2. 統合テスト
- **ナビゲーション**: ページ遷移の動作確認
- **認証**: ログイン・ログアウトの動作確認
- **権限**: 権限に基づく表示制御の確認
- **検索**: 検索機能の動作確認

### 3. E2Eテスト
- **ユーザーフロー**: エンドツーエンドの動作確認
- **レスポンシブ**: 各デバイスでの表示確認
- **アクセシビリティ**: アクセシビリティ要件の確認
- **パフォーマンス**: KPI目標の達成確認

## 保守性要件

### 1. コード品質
- **TypeScript**: 型安全性の確保
- **ESLint**: コード品質の統一
- **Prettier**: コードフォーマットの統一

### 2. ドキュメント
- **コメント**: 複雑なロジックの説明
- **README**: セットアップ・使用方法の説明
- **API仕様**: 外部APIの仕様書

### 3. バージョン管理
- **Git**: 適切なブランチ戦略
- **コミットメッセージ**: 明確なコミットメッセージ
- **リリース管理**: セマンティックバージョニング

## 今後の拡張予定

### 1. 機能追加
- **お気に入り**: よく使う機能のお気に入り登録
- **最近使用**: 最近使用した機能の表示
- **検索履歴**: 検索履歴の保存と表示
- **検索候補**: 検索時の候補表示

### 2. UI/UX改善
- **ダークモード**: ダークテーマの対応
- **カスタマイズ**: ユーザーによるカスタマイズ機能
- **アニメーション**: より豊富なアニメーション
- **音声検索**: 音声による検索機能

### 3. パフォーマンス改善
- **遅延読み込み**: コンポーネントの遅延読み込み
- **キャッシュ**: データのキャッシュ機能
- **最適化**: バンドルサイズの最適化
- **PWA対応**: プログレッシブウェブアプリ対応

---

**作成日**: 2024年12月
**バージョン**: 2.0.0
**作成者**: 開発チーム
